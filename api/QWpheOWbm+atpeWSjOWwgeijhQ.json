{"title":"Ajax四步和封装","date":"2020-07-16T05:38:54.000Z","date_formatted":{"ll":"Jul 16, 2020","L":"07/16/2020","MM-DD":"07-16"},"link":"Ajax四步和封装","tags":["ajax"],"categories":["学习"],"updated":"2020-07-16T06:38:26.725Z","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><h3 id=\"ajax四步\">Ajax四步<a href=\"#ajax四步\" title=\"Ajax四步\"></a></h3><p>1.创建一个<code>XMLHttpRequest</code>异步对象</p>\n<p>2.设置请求方式和请求地址</p>\n<blockquote>\n<p>xhr.open(“GET”,”地址”,true)   //true异步 ， false同步 </p>\n</blockquote>\n<p>3.<code>send</code>发送请求</p>\n<p>4.接受服务器响应的数据</p>\n<h4 id=\"常见的状态码\">常见的状态码<a href=\"#常见的状态码\" title=\"常见的状态码\"></a></h4><blockquote>\n<p><strong>1xx</strong>     (Informational) 信息性状态码，表示正在处理。</p>\n</blockquote>\n<blockquote>\n<p><strong>2xx</strong>     (Success) 成功状态码，表示请求正常。</p>\n</blockquote>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>值</th><th>说明</th></tr>\n</thead><tbody><tr>\n<td>200</td><td>成功</td></tr>\n<tr>\n<td>204</td><td>该状态码表示服务器接收到的请求已经处理完毕，但是服务器不需要返回响应体。</td></tr>\n</tbody></table></div></div><blockquote>\n<p><strong>3xx</strong>     (Redirection) 重定向状态码，表示客户端需要进行附加操作。</p>\n</blockquote>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>值</th><th>说明</th></tr>\n</thead><tbody><tr>\n<td>301</td><td>Moved Permanently 永久性重定向。</td></tr>\n<tr>\n<td>302</td><td>Found 临时性重定向。</td></tr>\n</tbody></table></div></div><blockquote>\n<p><strong>4xx</strong>     (Client Error) 客户端错误状态码，表示服务器无法处理请求。</p>\n</blockquote>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>值</th><th>说明</th></tr>\n</thead><tbody><tr>\n<td>400</td><td>Bad Request 指出客户端请求中的语法错误。</td></tr>\n<tr>\n<td>401</td><td>Unauthorized 该状态码表示发送的请求需要有认证。</td></tr>\n<tr>\n<td>403</td><td>Forbidden 该状态码表明对请求资源的访问被服务器拒绝了。</td></tr>\n<tr>\n<td>404</td><td>Not Found 该状态码表明服务器上无法找到指定的资源。</td></tr>\n</tbody></table></div></div><blockquote>\n<p><strong>5xx</strong>     (Server Error) 服务器错误状态码，表示服务器处理请求出错。</p>\n</blockquote>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>值</th><th>说明</th></tr>\n</thead><tbody><tr>\n<td>500</td><td>Internal Server Error 该状态码表明服务器端在执行请求时发生了错误。</td></tr>\n<tr>\n<td>502</td><td>Bad Gateway 该状态码表明服务器网关错误。</td></tr>\n<tr>\n<td>503</td><td>Service Unavailable 该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。</td></tr>\n</tbody></table></div></div><h3 id=\"第一种ajax封装方法\">第一种Ajax封装方法<a href=\"#第一种ajax封装方法\" title=\"第一种Ajax封装方法\"></a></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">$ajax</span>(<span class=\"params\">method,url,data</span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a,b</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\">    xhr.open(method,url,<span class=\"literal\">true</span>)</span><br><span class=\"line\">    xhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">         a(xhr.responseText)</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        b(<span class=\"string\">\"请求失败\"</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    data=<span class=\"built_in\">JSON</span>.stringify(data)||<span class=\"literal\">null</span></span><br><span class=\"line\">    xhr.send(data)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//$ajax(\"GET\",\"/bb\").then(function(res)&#123;console.log(res)&#125;,function(err)&#123;console.log(err)&#125;)</span></span><br><span class=\"line\">$ajax(<span class=\"string\">\"post\"</span>,<span class=\"string\">\"/aa\"</span>,&#123;<span class=\"attr\">name</span>:<span class=\"string\">\"xxxx\"</span>&#125;).then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span><span class=\"built_in\">console</span>.log(res),err=&gt;<span class=\"built_in\">console</span>.log(err))</span><br></pre></td></tr></table></figure><h3 id=\"第二种\">第二种<a href=\"#第二种\" title=\"第二种\"></a></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> $http=&#123;</span><br><span class=\"line\">  <span class=\"comment\">//写一个方法</span></span><br><span class=\"line\">  all(method,url,data)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">a,b</span>)=&gt;</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> xhr=<span class=\"keyword\">new</span> XMLHttpRequest()</span><br><span class=\"line\">      xhr.open(method,url,<span class=\"literal\">true</span>)</span><br><span class=\"line\">      xhr.onreadystatechange=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(xhr.status==<span class=\"number\">200</span>)&#123;</span><br><span class=\"line\">          a(xhr.responseText)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">          b(<span class=\"string\">\"请求失败\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(data)</span><br><span class=\"line\">      xhr.send(data)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"keyword\">get</span>(url)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.all(<span class=\"string\">\"GET\"</span>,url,<span class=\"literal\">null</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  post(url,data)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.all(<span class=\"string\">\"POST\"</span>,url,data)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$http.get(<span class=\"string\">\"/abc\"</span>).then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span><span class=\"built_in\">console</span>.log(res))</span><br><span class=\"line\">$http.post(<span class=\"string\">\"/abc\"</span>,[<span class=\"number\">1</span>,<span class=\"number\">5</span>,<span class=\"number\">2</span>]).then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span><span class=\"built_in\">console</span>.log(res))</span><br></pre></td></tr></table></figure>","prev":{"title":"给Hexo博客添加背景音乐","link":"给Hexo博客添加背景音乐"},"next":{"title":"原生js轮播图","link":"原生js轮播图"},"plink":"https://cyapi.github.io/Ajax四步和封装/","toc":[{"id":"ajax四步","title":"Ajax四步","index":"1"},{"id":"第一种ajax封装方法","title":"第一种Ajax封装方法","index":"2"},{"id":"第二种","title":"第二种","index":"3"}],"reward":true,"copyright":{"link":"<a href=\"https://cyapi.github.io/Ajax四步和封装/\" title=\"Ajax四步和封装\">https://cyapi.github.io/Ajax四步和封装/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}